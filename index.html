<!DOCTYPE html>
<html>
<head>
	<title>US Wildfires</title>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>

	<style type="text/css">
	.feature {
		fill: none;
		stroke: grey;
		stroke-width: 1px;
  		stroke-linejoin: round;
	}
	.mesh {
		fill: none;
  		stroke: lightgrey;
  		stroke-width: 2px;
  		stroke-linejoin: round;
	}
	h1 {
		font-family: sans-serif;
	}

	</style>
</head>
<body>
	<script type="text/javascript">

	var width = 950,
	    height = 550;

	// set projection
	var projection = d3.geo.mercator();

	// create path variable
	var path = d3.geo.path()
	    .projection(projection);

	// Maps fire class to a radius size
	var firesize_class_radius = { "A": 1, "B": 2, "C": 3, "D": 4, "E": 5, "F": 6, "G": 7 };

	// Maps cause of fire to a color


	d3.json("data/us.json", function(error, topo) { 
		d3.csv("data/wildfires_10k_sample.csv", function(error, data) {
			console.log(data);

		  	states = topojson.feature(topo, topo.objects.states).features

		  	// set projection parameters
		  	projection
		      .scale(900)
		      .center([-100, 40.5])

		    // create svg variable
		    var svg = d3.select("body").append("svg")
		    				.attr("width", width)
		    				.attr("height", height);

		    var g = svg.append("g");

			// add states from topojson
			g.selectAll("path")
		      .data(states).enter()
		      .append("path")
		      .attr("class", "feature")
		      .style("fill", "steelblue")
		      .attr("d", path);

		    // put boarder around states 
		  	g.append("path")
		      .datum(topojson.mesh(topo, topo.objects.states, function(a, b) { return a !== b; }))
		      .attr("class", "mesh")
		      .attr("d", path);

		    // add circles to svg
		    g.selectAll("circle")
				.data(data).enter()
				.append("circle")
				.attr("cx", function (d) { return projection([d.LONGITUDE, d.LATITUDE])[0]; })
				.attr("cy", function (d) { return projection([d.LONGITUDE, d.LATITUDE])[1]; })
				.attr("r", function (d) { return firesize_class_radius[d.FIRE_SIZE_CLASS]; })
				.attr("fill", function(d) { return "red"});

			// zooming and panning
			var zoom = d3.behavior.zoom()
			    .on("zoom",function() {
			        g.attr("transform","translate("+ 
			            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
			        g.selectAll("circle")
			            .attr("d", path.projection(projection));
			        g.selectAll("path")  
			            .attr("d", path.projection(projection)); 

			});
			svg.call(zoom);

		});
	});

	</script>
</body>
</html>